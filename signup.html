<!DOCTYPE html> 
<html lang="en"> 
<head> 
<meta charset="UTF-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
<title>CapsuleX - Sign Up</title> 
<link rel="stylesheet" href="style.css" /> 
  <script> 

  window.addEventListener('beforeunload', () => { 
  sessionStorage.removeItem('videoPlayed'); 
  }); 

  </script> 

</head> 
<body> 
  <div class="caption1">Hey Stalker!</div> 
  <div class="caption2">Say it without saying who you are.</div> 
  <div class="intro-logo">capsule<span class="grey-x">X</span></div> 
  <input type="text" id="name" placeholder="Name" autocomplete="new-password" /> 
  <input type="email" id="email" placeholder="Email address" autocomplete="new-password" /> 
  <input type="password" id="password" placeholder="Password" autocomplete="new-password" /> 
  <button id="signupBtn">Sign Up</button> 
  <div id="signupMessage" class="form-message"></div>
  <div class="or-text">OR</div> 
  <a href="login.html" class="signup-link">log in</a> 

  <script> 
  document.getElementById("signupBtn").addEventListener("click", async function () { 
  try { 
  const name = document.getElementById("name").value; 
  const email = document.getElementById("email").value; 
  const password = document.getElementById("password").value; 
  const response = await fetch("https://capsule-x-backend.onrender.com/api/auth/signup", { 
  method: "POST", 
  headers: { "Content-Type": "application/json" }, 
  body: JSON.stringify({ name, email, password }) 
  }); 
  const result = await response.json(); 
  if (response.ok) { 
  if (result.requiresVerification) {
  document.getElementById("signupMessage").textContent = "Please check your inbox to verify your account.";
  return;
}
  const loginRes = await fetch("https://capsule-x-backend.onrender.com/api/auth/login", { 
  method: "POST", 
  headers: { "Content-Type": "application/json" }, 
  body: JSON.stringify({ email, password }) 
  }); 
  const loginData = await loginRes.json(); 
  if (loginRes.ok) { 
  localStorage.setItem("token", loginData.token); 
  if (loginData.name) { 
  localStorage.setItem("name", loginData.name); 
  } else { 
  localStorage.setItem("name", name); 
  } 
  window.location.href = "dashboard.html"; 
  } else { 
  alert("Auto-login failed: " + (loginData.error || "Unknown error")); 
  window.location.href = "login.html"; // fallback redirect 
  } 
  } else { 
  alert("Signup failed: " + (result.error || "Unknown error")); 
  } 
  } catch (err) { 
  alert("Signup Error: " + err.message); 
  } 
}); 
window.addEventListener('DOMContentLoaded', () => { 
document.getElementById('name').value = ''; 
document.getElementById('email').value = ''; 
document.getElementById('password').value = ''; 
}); 
window.addEventListener('beforeunload', () => { 
sessionStorage.removeItem('videoPlayed'); 
}); 
</script> 
</body> 
</html> 