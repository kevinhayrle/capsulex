<script>
  document.getElementById("signupBtn").addEventListener("click", async function () {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const messageBox = document.getElementById("signupMessage");

    messageBox.textContent = '';
    messageBox.style.color = 'salmon';

    if (!name || !email || !password) {
      messageBox.textContent = "Please fill in all the fields.";
      return;
    }

    try {
      const response = await fetch("https://capsule-x-backend.onrender.com/api/auth/signup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, password })
      });

      const result = await response.json();

      if (!response.ok) {
        messageBox.textContent = result.error || "Signup failed.";
        return;
      }

      // ✅ OTP sent — proceed to OTP page
      sessionStorage.setItem("pending_email", email);
      messageBox.style.color = "lightgreen";
      messageBox.textContent = "OTP sent to your inbox. Redirecting...";
      setTimeout(() => window.location.href = "otp.html", 1200);

    } catch (err) {
      messageBox.textContent = "Error: " + err.message;
    }
  });

  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('name').value = '';
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';
  });

  window.addEventListener('beforeunload', () => {
    sessionStorage.removeItem('videoPlayed');
  });
  window.addEventListener('DOMContentLoaded', () => {
  const emailInput = document.getElementById('email');
  const storedEmail = sessionStorage.getItem('pending_email');
  if (storedEmail) emailInput.value = storedEmail;
});
</script>